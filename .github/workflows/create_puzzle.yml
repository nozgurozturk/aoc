name: Create Puzzle of Day

on:
  workflow_dispatch:
  schedule:
    - cron: '05 5 1-25 12 *'

jobs:
  create-puzzle-files:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: install pandoc
        run: |
          sudo wget https://github.com/jgm/pandoc/releases/download/2.16.2/pandoc-2.16.2-1-amd64.deb
          sudo dpkg -i pandoc-2.16.2-1-amd64.deb

      - name: run create puzzle script
        run: ./scripts/create_puzzle.sh 2020 3 ${{ secrets.AOC_SESSION }}
        shell: bash

      - name: get puzzle description
        run: pandoc -r html https://adventofcode.com/2020/day/3 -t gfm -o ./2020/3/README.md

      - name: git login
        run:  gh auth login --with-token ${{ secrets.GITHUB_TOKEN }}

      - name: create branch
        run: git checkout -b 2020/03

      - name: check for changes
        run: git status

      - name: stage changed files
        run: git add .

      - name: commit changed files
        run: git commit -m "Add puzzle 2020-3 setup"

      - name: push changes
        run: git push --set-upstream origin 2020/03
