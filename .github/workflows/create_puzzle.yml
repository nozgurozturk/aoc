name: Create Puzzle of Day
on:
  workflow_dispatch:
  schedule:
    - cron: '05 5 1-25 12 *'
jobs:
  create-puzzle-files:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: install pandoc
        run: |
          sudo wget https://github.com/jgm/pandoc/releases/download/2.16.2/pandoc-2.16.2-1-amd64.deb
          sudo dpkg -i pandoc-2.16.2-1-amd64.deb
          rm -rf pandoc-2.16.2-1-amd64.deb

      - name: set output variables
        id: vars
        run: |
          echo ::set-output name=year::"2020"
          echo ::set-output name=day_fixed::"03"
          echo ::set-output name=day::"3"
#          echo ::set-output name=year::"$(date +%Y)"
#          echo ::set-output name=day_fixed::"$(date +%d)"
#          echo ::set-output name=day::"$(date +%-d)"

      - name: run create puzzle script
        run: ./scripts/create_puzzle.sh ${{ steps.vars.outputs.year }} ${{ steps.vars.outputs.day }} ${{ secrets.AOC_SESSION }}
        shell: bash

      - name: get puzzle description
        run: pandoc -r html https://adventofcode.com/${{ steps.vars.outputs.year }}/day/${{ steps.vars.outputs.day }} -t gfm -o ./${{ steps.vars.outputs.year }}/${{ steps.vars.outputs.day_fixed }}/README.md

      - name: create pull request
        uses: peter-evans/create-pull-request@v3
        with:
          commit-message: "add initial setup for [${{ steps.vars.outputs.year }}][${{ steps.vars.outputs.day_fixed }}]"
          title: "Add new puzzle ${{ steps.vars.outputs.year }} ${{ steps.vars.outputs.day }}"
          body: "[AOC](https://adventofcode.com/${{ steps.vars.outputs.year }}/day/${{ steps.vars.outputs.day }})"
          branch: ${{ steps.vars.outputs.year }}/${{ steps.vars.outputs.day_fixed }}
